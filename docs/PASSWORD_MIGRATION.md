# 비밀번호 마이그레이션 가이드

## 개요

시스템이 Google 계정 기반에서 ID/PW 기반 로그인으로 변경되었습니다. 기존 사용자들의 비밀번호를 설정하는 방법을 안내합니다.

## 마이그레이션 방법

### 방법 1: 전체 사용자 기본 비밀번호 설정 (권장)

모든 사용자에게 동일한 기본 비밀번호를 설정하고, 첫 로그인 시 변경하도록 안내합니다.

#### 1단계: Apps Script에서 함수 실행

1. Apps Script 에디터에서 **Auth.gs** 선택
2. 함수 선택: **initializeAllPasswords**
3. **실행** 버튼 클릭
4. 함수 매개변수 입력:
   - `defaultPassword`: 기본 비밀번호 (예: `password123`)
   - `sessionToken`: 관리자 세션 토큰 (임시로 빈 문자열 `""` 사용 가능, 관리자 권한 필요)

**또는 직접 실행:**

```javascript
// 관리자로 로그인한 후 실행
initializeAllPasswords('password123', '관리자세션토큰');
```

#### 2단계: 사용자에게 안내

- 기본 비밀번호를 사용자에게 안내
- 첫 로그인 시 비밀번호 변경 권장

### 방법 2: 개별 사용자 비밀번호 설정

각 사용자별로 개별 비밀번호를 설정합니다.

#### Apps Script에서 실행

```javascript
// 관리자로 로그인한 후
resetUserPassword('사용자ID', '새비밀번호', '관리자세션토큰');
```

### 방법 3: 사용자관리 시트에서 직접 입력

#### 1단계: 비밀번호 해시 생성

1. Apps Script 에디터에서 **Auth.gs** 선택
2. 함수 선택: **hashPassword**
3. **실행** 버튼 클릭
4. 매개변수 입력: 원하는 비밀번호 (예: `password123`)
5. 결과 복사 (해시 값)

#### 2단계: 시트에 입력

1. **사용자관리** 시트 열기
2. 각 사용자의 **비밀번호해시** 컬럼(B열)에 해시 값 입력

## 사용자관리 시트 구조

### 변경 전
```
이메일 | 이름 | 기사코드 | 소속팀 | 지역 | 역할 | 활성화
```

### 변경 후
```
사용자ID | 비밀번호해시 | 이름 | 기사코드 | 소속팀 | 지역 | 역할 | 활성화
```

## 초기 비밀번호 설정 예시

### 샘플 데이터

현재 샘플 데이터의 기본 비밀번호는 `password`입니다.

| 사용자ID | 비밀번호해시 | 이름 | ... |
|---------|-------------|------|-----|
| admin | 5e884898da... | 관리자 | ... |
| hong | 5e884898da... | 홍길동 | ... |

**기본 비밀번호**: `password`

## 비밀번호 정책 권장사항

1. **최소 8자 이상**
2. **영문, 숫자, 특수문자 조합** (선택사항)
3. **정기적 변경** (3개월마다 권장)
4. **개인정보 포함 금지**

## 사용자 안내

### 첫 로그인 시

1. 관리자로부터 받은 기본 비밀번호로 로그인
2. 로그인 후 즉시 비밀번호 변경
3. 비밀번호 변경은 **마이페이지** 또는 **설정** 메뉴에서 가능

### 비밀번호 변경 방법

1. 로그인 후 상단 메뉴에서 **비밀번호 변경** 클릭
2. 기존 비밀번호 입력
3. 새 비밀번호 입력 (2회)
4. 변경 완료

## 보안 고려사항

### 비밀번호 저장

- 비밀번호는 **SHA-256 해시**로 저장
- 평문 비밀번호는 절대 저장하지 않음
- 해시는 복호화 불가능 (단방향 암호화)

### 세션 관리

- 세션 토큰은 **1시간** 후 자동 만료
- 로그아웃 시 세션 즉시 삭제
- 세션 토큰은 URL 파라미터로 전달 (HTTPS 권장)

## 문제 해결

### Q: 비밀번호를 잊어버렸어요

**A**: 관리자에게 문의하여 비밀번호 초기화 요청

### Q: 로그인이 안 돼요

**A**: 
1. 사용자ID와 비밀번호 확인
2. 대소문자 구분 확인
3. 비밀번호가 설정되어 있는지 확인 (시트의 비밀번호해시 컬럼)
4. 관리자에게 문의

### Q: 비밀번호 해시를 직접 만들고 싶어요

**A**: Apps Script에서 다음 함수 실행:
```javascript
hashPassword('원하는비밀번호');
```

결과를 사용자관리 시트의 비밀번호해시 컬럼에 입력

## 관리자 기능

### 비밀번호 초기화

관리자는 다음 함수로 사용자 비밀번호를 초기화할 수 있습니다:

```javascript
resetUserPassword('사용자ID', '새비밀번호', '관리자세션토큰');
```

### 전체 비밀번호 초기화

모든 사용자의 비밀번호를 한 번에 초기화:

```javascript
initializeAllPasswords('기본비밀번호', '관리자세션토큰');
```

## 마이그레이션 체크리스트

- [ ] 사용자관리 시트 구조 변경 확인
- [ ] 모든 사용자에게 사용자ID 할당
- [ ] 기본 비밀번호 설정 (또는 개별 설정)
- [ ] 사용자에게 기본 비밀번호 안내
- [ ] 첫 로그인 시 비밀번호 변경 유도
- [ ] 로그인 테스트
- [ ] 비밀번호 변경 기능 테스트

## 참고

- 비밀번호 해시는 SHA-256 알고리즘 사용
- 세션은 CacheService를 통해 관리 (1시간 TTL)
- 비밀번호는 절대 평문으로 저장하지 않음





