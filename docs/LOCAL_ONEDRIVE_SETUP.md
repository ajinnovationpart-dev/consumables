# 로컬 OneDrive + Excel 설정 가이드

부품발주시스템이 **로컬 OneDrive 폴더**와 **Excel(.xlsx)** 파일을 사용하도록 구성된 경우의 설정 방법입니다.

## 폴더 구조

로컬 OneDrive 경로 예 (Windows):

```
C:\Users\User\OneDrive - AJ네트웍스\소모품발주\
  ├── 소모품발주.xlsx      ← 데이터 (신청내역, 사용자관리, 코드관리, 배송지관리, 로그 시트)
  └── 첨부 파일\           ← 신청번호별 이미지 폴더
      ├── 2501010001\      ← 신청번호 폴더
      │   ├── 2501010001_1735123456789.jpg
      │   └── ...
      ├── 2501010002\
      └── ...
```

- **소모품발주.xlsx**: 하나의 Excel 파일에 시트별로 데이터 저장  
  - `신청내역`, `사용자관리`, `코드관리`, `배송지관리`, `로그`
- **첨부 파일**: 신청 시 업로드한 이미지는 `첨부 파일\{신청번호}\` 아래에 저장됩니다.

## 1. 폴더 생성

다음 폴더가 없으면 만들어 두세요.

- `C:\Users\User\OneDrive - AJ네트웍스\소모품발주`

(다른 경로를 쓰려면 아래 환경 변수에서 변경합니다.)

## 2. 백엔드 환경 변수

`backend/` 디렉터리에 `.env` 파일을 만들고 아래처럼 설정합니다.

```env
# 로컬 OneDrive 경로 (소모품발주 폴더 전체 경로)
LOCAL_ONEDRIVE_PATH=C:\Users\User\OneDrive - AJ네트웍스\소모품발주

# Excel 파일명 (위 폴더 안의 파일명)
EXCEL_FILE=소모품발주.xlsx

# 첨부 파일이 저장될 폴더명 (위 폴더 안에 생성됨)
ATTACHMENTS_FOLDER=첨부 파일

PORT=3030
JWT_SECRET=비밀키-프로덕션에서-변경
JWT_EXPIRES_IN=24h
```

- `LOCAL_ONEDRIVE_PATH`: **소모품발주** 폴더의 전체 경로  
  - 예: `C:\Users\User\OneDrive - AJ네트웍스\소모품발주`
- `EXCEL_FILE`: 그 안에 있는 Excel 파일 이름 (기본값: `소모품발주.xlsx`)
- `ATTACHMENTS_FOLDER`: 그 안에서 이미지를 저장할 폴더 이름 (기본값: `첨부 파일`)

## 3. Excel 파일 준비

**소모품발주.xlsx**가 아직 없으면:

- 백엔드를 한 번 실행하면 `소모품발주.xlsx`가 위 경로에 자동 생성됩니다.
- 생성되는 파일에는 `신청내역`, `사용자관리`, `코드관리`, `배송지관리`, `로그` 시트가 포함됩니다.

이미 사용 중인 **소모품발주.xlsx**가 있다면:

- 같은 폴더에 두고, 위에서 지정한 `EXCEL_FILE` 이름과 맞추면 됩니다.
- 시트 이름은 `신청내역`, `사용자관리`, `코드관리`, `배송지관리`, `로그`로 맞춰 주세요.

## 4. 첨부 파일(이미지) 저장 규칙

- 모든 신청 이미지는 **첨부 파일** 폴더 아래에 **신청번호별 폴더**로 저장됩니다.
- 예: 신청번호 `2501010001` → `C:\Users\User\OneDrive - AJ네트웍스\소모품발주\첨부 파일\2501010001\`  
  - 그 안에 `2501010001_타임스탬프.jpg` 형태로 파일이 생성됩니다.

## 5. 백엔드 실행

```bash
cd backend
npm install
npm run dev
```

- API: `http://localhost:3030`
- 첫 실행 시 `LOCAL_ONEDRIVE_PATH`에 지정한 폴더가 없으면 해당 경로(및 상위 경로)를 만들고, 그 안에 `소모품발주.xlsx`를 생성합니다.

## 6. 프론트엔드

기존 React 앱을 그대로 사용하면 됩니다. 개발 서버에서 `/api`는 백엔드(3030)로 프록시되므로, 이미지 URL은 `/api/attachments/{신청번호}/{파일명}` 형태로 요청됩니다.

## 요약

| 항목 | 값 |
|------|-----|
| 데이터 | 로컬 `소모품발주.xlsx` (시트: 신청내역, 사용자관리, 코드관리, 배송지관리, 로그) |
| 이미지 | 로컬 `첨부 파일\{신청번호}\` 폴더 |
| 기본 경로 | `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` (환경 변수로 변경 가능) |
