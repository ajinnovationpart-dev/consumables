# 필요한 설정 체크리스트

**로컬(OneDrive + 백엔드) + GitHub(프론트)** 구조로 쓰기 위한 설정을 순서대로 정리했습니다.

**적용된 정보**
- OneDrive 폴더: `C:\Users\User\OneDrive - AJ네트웍스\소모품발주`
- Excel 파일: `소모품발주.xlsx` (위 폴더 안)
- 첨부 파일: `첨부 파일` 폴더 안에 **신청번호별** 하위 폴더로 이미지 저장

---

## 1. 로컬 PC (OneDrive + 백엔드)

### 1-1. 폴더 준비

- [ ] 아래 폴더가 있는지 확인 (없으면 생성)

```
C:\Users\User\OneDrive - AJ네트웍스\소모품발주
```

- 이 폴더 안에 **소모품발주.xlsx** 와 **첨부 파일** 폴더가 사용됩니다.
- 다른 경로를 쓰려면 아래 `.env` 에서 `LOCAL_ONEDRIVE_PATH` 를 그 경로로 지정하면 됩니다.

---

### 1-2. 백엔드 환경 변수 (.env)

- [ ] `backend` 폴더 안에 **`.env`** 파일 생성
- [ ] 아래 내용을 넣고, 필요하면 값만 수정

```env
# 로컬 OneDrive 경로 (AJ네트웍스 OneDrive → 소모품발주 폴더)
LOCAL_ONEDRIVE_PATH=C:\Users\User\OneDrive - AJ네트웍스\소모품발주

# Excel 파일명 (위 폴더 안에 있는 소모품발주.xlsx)
EXCEL_FILE=소모품발주.xlsx

# 첨부 파일: 위 폴더 안에 "첨부 파일" 폴더, 그 안에 신청번호별 폴더로 이미지 저장
ATTACHMENTS_FOLDER=첨부 파일

PORT=3030
NODE_ENV=development

# 로그인 세션용 비밀키 (반드시 본인만 아는 값으로 변경)
JWT_SECRET=여기에-긴-랜덤-문자열-입력
JWT_EXPIRES_IN=24h
```

| 항목 | 적용값 | 설명 |
|------|--------|------|
| `LOCAL_ONEDRIVE_PATH` | `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` | 소모품발주 폴더 전체 경로 |
| `EXCEL_FILE` | `소모품발주.xlsx` | 위 폴더 안의 Excel 파일 |
| `ATTACHMENTS_FOLDER` | `첨부 파일` | 신청번호별 이미지가 저장되는 폴더명 |
| `JWT_SECRET` | (직접 입력) | 아무 긴 문자열 (예: 비밀번호처럼) |

- **참고**: `backend/env.example.txt` 를 복사해서 `.env` 로 이름 바꾼 뒤 수정해도 됩니다.

---

### 1-3. 백엔드 실행

- [ ] 터미널에서 아래 실행

```bash
cd backend
npm install
npm run dev
```

- [ ] 콘솔에 `API running at http://localhost:3030` 나오면 성공
- **소모품발주.xlsx** 가 없으면 이때 `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` 안에 자동 생성됩니다.
- 이미지는 신청 시 `첨부 파일\{신청번호}\` 폴더에 저장됩니다.

---

### 1-4. (선택) 외부에서 접속할 때 — ngrok

- GitHub Pages 에 올린 프론트가 **다른 PC/휴대폰**에서 접속할 때만 필요합니다.
- [ ] [ngrok](https://ngrok.com/) 설치 후:

```bash
ngrok http 3030
```

- [ ] 나온 **https://xxxx.ngrok-free.app** 주소 복사
- [ ] 아래 **2-2. GitHub Secrets** 에서 `VITE_API_URL` 값에 `https://xxxx.ngrok-free.app/api` 로 넣기 (끝에 `/api` 필수)

---

## 2. GitHub (프론트 배포)

### 2-1. 코드 올리기

- [ ] 이 프로젝트를 GitHub 저장소에 push (이미 했다면 생략)

```bash
git remote add origin https://github.com/사용자명/저장소명.git
git push -u origin main
```

---

### 2-2. GitHub Pages 소스 설정

- [ ] 저장소 **Settings** → 왼쪽 **Pages**
- [ ] **Build and deployment** → **Source** 를 **GitHub Actions** 로 선택

---

### 2-3. GitHub Secrets (API 주소)

- [ ] 저장소 **Settings** → **Secrets and variables** → **Actions**
- [ ] **New repository secret** 클릭
  - **Name**: `VITE_API_URL`
  - **Value**:
    - **같은 PC에서만** 쓸 때: `http://localhost:3030/api`
    - **다른 기기에서** 쓸 때: ngrok URL + `/api`  
      예: `https://abcd1234.ngrok-free.app/api`

- (선택) **서브경로**에 배포하는 경우만:
  - **Name**: `VITE_BASE_PATH`
  - **Value**: `/{저장소이름}/`  
    예: `/ordering_consumables/`

---

### 2-4. 배포 실행

- [ ] `main` 브랜치에 push 하면 자동으로 프론트 빌드 후 GitHub Pages 에 배포됩니다.
- [ ] 배포 완료 후 접속 주소:  
  - 서브경로 없음: `https://<GitHub사용자명>.github.io/<저장소이름>/`  
  - 서브경로 있음: `https://<GitHub사용자명>.github.io/<저장소이름>/` (Secrets에 `VITE_BASE_PATH` 설정한 경우)

---

## 3. 로컬에서 프론트만 개발할 때

- [ ] 프론트만 띄워서 백엔드와 연동 테스트:

```bash
cd frontend
npm install
npm run dev
```

- 브라우저: `http://localhost:5173`  
- API 는 자동으로 `localhost:3030` 로 프록시됩니다. (별도 `VITE_API_URL` 불필요)

---

## 4. 한 번에 체크

| 구분 | 할 일 | 완료 |
|------|--------|------|
| 로컬 | `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` 폴더 확인/생성 | ☐ |
| 로컬 | `backend/.env` 생성 (LOCAL_ONEDRIVE_PATH, EXCEL_FILE, 첨부 파일, JWT_SECRET) | ☐ |
| 로컬 | `cd backend && npm install && npm run dev` 실행 | ☐ |
| (선택) | ngrok 설치 후 `ngrok http 3030` 실행, URL 복사 | ☐ |
| GitHub | Pages → Source: **GitHub Actions** | ☐ |
| GitHub | Secrets → `VITE_API_URL` 추가 (끝에 `/api` 포함) | ☐ |
| GitHub | `main` 에 push → 자동 배포 확인 | ☐ |

---

## 5. 문제 생겼을 때

- **로그인이 안 돨 때**  
  - `C:\Users\User\OneDrive - AJ네트웍스\소모품발주\소모품발주.xlsx` 의 **사용자관리** 시트에 사용자 행이 있는지 확인  
  - 비밀번호 해시는 SHA-256 (Node: `require('crypto').createHash('sha256').update('비밀번호').digest('hex')`)

- **GitHub Pages 에서 API 호출 실패**  
  - Secrets 의 `VITE_API_URL` 이 `https://.../api` 형태인지 확인  
  - 같은 PC에서만 쓸 때는 `http://localhost:3030/api` 로 두면, **그 PC의 브라우저**에서만 동작합니다. 다른 기기는 ngrok URL 이 필요합니다.

- **이미지가 안 보일 때**  
  - 백엔드가 켜져 있는지, `VITE_API_URL` 이 맞는지 확인  
  - 첨부 파일 경로: `C:\Users\User\OneDrive - AJ네트웍스\소모품발주\첨부 파일\{신청번호}\` 아래에 파일이 있는지 확인

이 체크리스트만 따라 하면 **로컬(OneDrive+백엔드) + GitHub(프론트)** 필요한 설정은 모두 끝납니다.
