# 필요한 설정 체크리스트

**로컬(OneDrive + 백엔드) + GitHub(프론트)** 구조로 쓰기 위한 설정을 순서대로 정리했습니다.

**적용된 정보**
- OneDrive 폴더: `C:\Users\User\OneDrive - AJ네트웍스\소모품발주`
- Excel 파일: `소모품발주.xlsx` (위 폴더 안)
- 첨부 파일: `첨부 파일` 폴더 안에 **신청번호별** 하위 폴더로 이미지 저장

---

## 1. 로컬 PC (OneDrive + 백엔드)

### 1-1. 폴더 준비

- [ ] 아래 폴더가 있는지 확인 (없으면 생성)

```
C:\Users\User\OneDrive - AJ네트웍스\소모품발주
```

- 이 폴더 안에 **소모품발주.xlsx** 와 **첨부 파일** 폴더가 사용됩니다.
- 다른 경로를 쓰려면 아래 `.env` 에서 `LOCAL_ONEDRIVE_PATH` 를 그 경로로 지정하면 됩니다.

---

### 1-2. 백엔드 환경 변수 (.env)

- [ ] `backend` 폴더 안에 **`.env`** 파일 생성
- [ ] 아래 내용을 넣고, 필요하면 값만 수정

```env
# 로컬 OneDrive 경로 (AJ네트웍스 OneDrive → 소모품발주 폴더)
LOCAL_ONEDRIVE_PATH=C:\Users\User\OneDrive - AJ네트웍스\소모품발주

# Excel 파일명 (위 폴더 안에 있는 소모품발주.xlsx)
EXCEL_FILE=소모품발주.xlsx

# 첨부 파일: 위 폴더 안에 "첨부 파일" 폴더, 그 안에 신청번호별 폴더로 이미지 저장
ATTACHMENTS_FOLDER=첨부 파일

PORT=3030
NODE_ENV=development

# 로그인 세션용 비밀키 (반드시 본인만 아는 값으로 변경)
JWT_SECRET=여기에-긴-랜덤-문자열-입력
JWT_EXPIRES_IN=24h
```

| 항목 | 적용값 | 설명 |
|------|--------|------|
| `LOCAL_ONEDRIVE_PATH` | `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` | 소모품발주 폴더 전체 경로 |
| `EXCEL_FILE` | `소모품발주.xlsx` | 위 폴더 안의 Excel 파일 |
| `ATTACHMENTS_FOLDER` | `첨부 파일` | 신청번호별 이미지가 저장되는 폴더명 |
| `JWT_SECRET` | (직접 입력) | 아무 긴 문자열 (예: 비밀번호처럼) |

- **참고**: `backend/env.example.txt` 를 복사해서 `.env` 로 이름 바꾼 뒤 수정해도 됩니다.

---

### 1-3. 백엔드 실행

- [ ] 터미널에서 아래 실행

```bash
cd backend
npm install
npm run dev
```

- [ ] 콘솔에 `API running at http://localhost:3030` 나오면 성공
- **소모품발주.xlsx** 가 없으면 이때 `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` 안에 자동 생성됩니다.
- 이미지는 신청 시 `첨부 파일\{신청번호}\` 폴더에 저장됩니다.

---

### 1-4. (선택) 외부에서 접속할 때 — ngrok

- GitHub Pages 에 올린 프론트가 **다른 PC/휴대폰**에서 접속할 때만 필요합니다.
- [ ] [ngrok](https://ngrok.com/) 설치 후:

```bash
ngrok http 3030
```

- [ ] 나온 **https://xxxx.ngrok-free.app** 주소 복사
- [ ] 아래 **2-2. GitHub Secrets** 에서 `VITE_API_URL` 값에 `https://xxxx.ngrok-free.app/api` 로 넣기 (끝에 `/api` 필수)

---

## 2. GitHub (프론트 배포)

### 2-0. Index 페이지 (첫 화면) 안내

- **index 페이지는 있습니다.** React 앱의 진입점이 `frontend/index.html` 이고, 빌드 시 `frontend/dist/index.html` 로 나옵니다.
- GitHub Actions 가 이 `dist` 폴더를 그대로 GitHub Pages 에 올리므로, 접속 주소(`https://ajinnovationpart-dev.github.io/consumables/`)로 들어가면 **index.html** 이 로드됩니다.
- 앱 안에서는 **경로 `/`** 가 로그인 후 **`/dashboard`** 로 리다이렉트되도록 되어 있어, 첫 화면이 대시보드로 보이게 됩니다.

---

### 2-1. 코드 올리기

- [ ] 이 프로젝트를 GitHub 저장소에 push (이미 했다면 생략)

```bash
git remote add origin https://github.com/사용자명/저장소명.git
git push -u origin main
```

---

### 2-2. GitHub Pages 소스 설정

- [ ] 저장소 **Settings** → 왼쪽 **Pages**
- [ ] **Build and deployment** → **Source** 를 **GitHub Actions** 로 선택

---

### 2-3. GitHub Secrets — 백엔드 주소(`VITE_API_URL`) 설정 방법

GitHub Pages 에 올라간 프론트가 **어느 백엔드 주소로 API 요청을 보낼지** 빌드 시점에 넣어 줘야 합니다. 이 값은 **Secret** 으로 저장합니다.

#### 1) 들어가는 위치

1. GitHub 에서 해당 저장소 열기: `https://github.com/ajinnovationpart-dev/consumables`
2. 상단 탭 **Settings** 클릭
3. 왼쪽 메뉴에서 **Secrets and variables** → **Actions** 클릭
4. **New repository secret** 버튼 클릭

#### 2) 넣는 값 (Name / Value)

| 입력란 | 넣을 값 |
|--------|---------|
| **Name** | `VITE_API_URL` (그대로 입력) |
| **Value** | 아래 **상황별** 에서 하나 선택 |

#### 3) Value — 상황별로 정하기

**같은 PC에서만** GitHub Pages 사이트를 쓸 때 (그 PC 브라우저에서만 접속):

- **Value**: `http://localhost:3030/api`
- 조건: 그 PC 에서 백엔드를 `npm run dev` 로 켜 둔 상태여야 함.
- 참고: 휴대폰·다른 PC에서는 이 주소로 접속할 수 없어 API 가 실패합니다.

**다른 기기(휴대폰, 다른 PC)에서도** 쓰려면 — ngrok 으로 백엔드 공개:

1. [ngrok](https://ngrok.com/) 가입·설치 후, 백엔드가 돌아가는 PC 에서 터미널 실행:
   ```bash
   ngrok http 3030
   ```
2. 터미널에 나오는 **https 로 시작하는 주소** 복사  
   예: `https://abcd1234.ngrok-free.app`
3. **끝에 `/api` 를 붙인 값**을 Secret 의 Value 로 넣기  
   예: `https://abcd1234.ngrok-free.app/api`
4. ngrok 은 실행해 둔 동안만 유효하므로, 다른 기기에서 쓸 때마다 같은 PC 에서 `ngrok http 3030` 을 켜 두어야 합니다.

정리:

- **Value 는 반드시 `/api` 로 끝나야 합니다.** (예: `https://xxxx.ngrok-free.app/api`)
- Secret 저장 후 **다음 push 부터** 새 값이 적용됩니다. (이미 배포된 빌드는 다시 push 하거나 Actions 에서 “Re-run” 해야 반영됨)

#### 4) (선택) 서브경로 배포 시

이 저장소는 **consumables** 이므로 Pages 주소가 `https://ajinnovationpart-dev.github.io/consumables/` 입니다.  
워크플로에서 이미 기본값 `/consumables/` 를 쓰므로 **별도 Secret 없이** 동작합니다.  
다른 경로를 쓰려면:

- **Name**: `VITE_BASE_PATH`
- **Value**: `/consumables/` (또는 사용할 서브경로, 끝에 `/` 포함)

---

### 2-4. 배포 실행

- [ ] `main` 브랜치에 push 하면 자동으로 프론트 빌드 후 GitHub Pages 에 배포됩니다.
- [ ] 배포 완료 후 접속 주소:  
  - 서브경로 없음: `https://<GitHub사용자명>.github.io/<저장소이름>/`  
  - 서브경로 있음: `https://<GitHub사용자명>.github.io/<저장소이름>/` (Secrets에 `VITE_BASE_PATH` 설정한 경우)

---

## 3. 로컬에서 프론트만 개발할 때

- [ ] 프론트만 띄워서 백엔드와 연동 테스트:

```bash
cd frontend
npm install
npm run dev
```

- 브라우저: `http://localhost:5173`  
- API 는 자동으로 `localhost:3030` 로 프록시됩니다. (별도 `VITE_API_URL` 불필요)

---

## 4. 한 번에 체크

| 구분 | 할 일 | 완료 |
|------|--------|------|
| 로컬 | `C:\Users\User\OneDrive - AJ네트웍스\소모품발주` 폴더 확인/생성 | ☐ |
| 로컬 | `backend/.env` 생성 (LOCAL_ONEDRIVE_PATH, EXCEL_FILE, 첨부 파일, JWT_SECRET) | ☐ |
| 로컬 | `cd backend && npm install && npm run dev` 실행 | ☐ |
| (선택) | ngrok 설치 후 `ngrok http 3030` 실행, URL 복사 | ☐ |
| GitHub | Pages → Source: **GitHub Actions** | ☐ |
| GitHub | Secrets → `VITE_API_URL` 추가 (끝에 `/api` 포함) | ☐ |
| GitHub | `main` 에 push → 자동 배포 확인 | ☐ |

---

## 5. 문제 생겼을 때

- **로그인이 안 돨 때**  
  - `C:\Users\User\OneDrive - AJ네트웍스\소모품발주\소모품발주.xlsx` 의 **사용자관리** 시트에 사용자 행이 있는지 확인  
  - 비밀번호 해시는 SHA-256 (Node: `require('crypto').createHash('sha256').update('비밀번호').digest('hex')`)

- **GitHub Pages 에서 API 호출 실패**  
  - Secrets 의 `VITE_API_URL` 이 `https://.../api` 형태인지 확인  
  - 같은 PC에서만 쓸 때는 `http://localhost:3030/api` 로 두면, **그 PC의 브라우저**에서만 동작합니다. 다른 기기는 ngrok URL 이 필요합니다.

- **이미지가 안 보일 때**  
  - 백엔드가 켜져 있는지, `VITE_API_URL` 이 맞는지 확인  
  - 첨부 파일 경로: `C:\Users\User\OneDrive - AJ네트웍스\소모품발주\첨부 파일\{신청번호}\` 아래에 파일이 있는지 확인

- **Excel 에 데이터가 있는데 대시보드에 0 으로 나올 때**  
  - 백엔드가 읽는 파일이 **같은 Excel** 인지 확인: `backend/.env` 의 `LOCAL_ONEDRIVE_PATH` 가 **소모품발주.xlsx 가 있는 폴더**와 일치하는지 확인  
  - Excel 컬럼명이 다르면(예: 신청자이머, 접수담당지) 백엔드가 별칭으로 읽도록 되어 있음. 그래도 안 나오면 백엔드를 재시작한 뒤 페이지 새로고침

이 체크리스트만 따라 하면 **로컬(OneDrive+백엔드) + GitHub(프론트)** 필요한 설정은 모두 끝납니다.
