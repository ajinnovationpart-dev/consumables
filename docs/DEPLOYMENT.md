# 부품발주시스템 배포 가이드

## 📋 목차

1. [사전 준비사항](#사전-준비사항)
2. [스프레드시트 생성](#스프레드시트-생성)
3. [Apps Script 프로젝트 설정](#apps-script-프로젝트-설정)
4. [코드 배포](#코드-배포)
5. [초기 설정](#초기-설정)
6. [웹 앱 배포](#웹-앱-배포)
7. [트리거 설정](#트리거-설정)
8. [테스트](#테스트)
9. [문제 해결](#문제-해결)

---

## 사전 준비사항

### 필수 요구사항

- Google Workspace 계정 (또는 개인 Google 계정)
- 스프레드시트 생성 권한
- Apps Script 실행 권한

### 권장 환경

- Google Chrome (최신 버전)
- 인터넷 연결

---

## 스프레드시트 생성

### 1단계: 새 스프레드시트 생성

1. [Google Sheets](https://sheets.google.com) 접속
2. **새로 만들기** → **빈 스프레드시트** 클릭
3. 스프레드시트 이름 변경: `부품발주관리_마스터`

### 2단계: 시트 생성 및 구조 설정

#### 시트 생성

1. 하단 시트 탭에서 **+** 버튼 클릭하여 다음 시트들을 생성:
   - `신청내역`
   - `사용자관리`
   - `코드관리`
   - `로그`
   - `대시보드` (선택사항)

2. 기본 시트(`시트1`) 삭제

#### 헤더 입력

**신청내역 시트** (A1:Y1)
```
신청번호, 신청일시, 신청자이메일, 신청자이름, 기사코드, 소속팀, 지역, 품명, 모델명, 시리얼번호, 수량, 관리번호, 수령지, 전화번호, 업체명, 비고, 사진URL, 상태, 접수담당자, 담당자비고, 발주일시, 예상납기일, 수령확인일시, 최종수정일시, 최종수정자
```

**사용자관리 시트** (A1:G1)
```
이메일, 이름, 기사코드, 소속팀, 지역, 역할, 활성화
```

**코드관리 시트** 구조:
- A1:D10: 지역 코드 (코드, 지역명, 사용여부, 정렬순서)
- A12:D30: 소속팀 코드 (코드, 팀명, 지역, 사용여부)
- A32:D40: 상태 코드 (코드, 상태명, 사용여부, 색상코드)

**로그 시트** (A1:F1)
```
일시, 레벨, 액션, 신청번호, 사용자, 상세내용
```

### 3단계: 샘플 데이터 입력

**사용자관리 시트**에 최소 1명의 관리자 계정 입력:
```
admin@company.com, 관리자, -, 본사, 천안, 관리자, Y
```

**코드관리 시트**에 기본 코드 입력 (템플릿 CSV 파일 참고)

---

## Apps Script 프로젝트 설정

### 1단계: Apps Script 에디터 열기

1. 스프레드시트에서 **도구** → **스크립트 편집기** 클릭
2. 새 탭에서 Apps Script 에디터가 열림

### 2단계: 프로젝트 이름 설정

1. 왼쪽 상단 프로젝트 이름 클릭
2. 이름 변경: `부품발주시스템`

### 3단계: 파일 구조 생성

Apps Script 에디터에서 다음 파일들을 생성:

#### 백엔드 파일 (.gs)

1. **Config.gs** - 설정 파일
2. **Models.gs** - 데이터 모델
3. **Services.gs** - 비즈니스 로직
4. **Utils.gs** - 유틸리티 함수
5. **Triggers.gs** - 트리거 핸들러
6. **Code.gs** - 메인 엔트리 포인트

#### 프론트엔드 파일 (.html)

**중요**: Apps Script에서는 폴더 구조를 만들 수 없으므로 모든 HTML 파일을 루트에 생성합니다.

1. **+** 버튼 클릭 → **HTML** 선택하여 다음 파일들 생성:
   - **LoginPage.html** - 로그인 화면
   - **Stylesheet.html** - CSS 스타일
   - **JavaScript.html** - 공통 JavaScript
   - **UserPage.html** - 신청자 화면
   - **AdminPage.html** - 관리자 화면
   - **Unauthorized.html** - 권한 없음 화면

**참고**: 파일 이름은 정확히 일치해야 합니다 (대소문자 구분).

### 4단계: 코드 복사 및 붙여넣기

각 파일에 제공된 코드를 복사하여 붙여넣기

**파일 생성 방법**:
1. **.gs 파일**: 왼쪽 **+** 버튼 클릭 → **스크립트** 선택 → 파일 이름 입력
2. **.html 파일**: 왼쪽 **+** 버튼 클릭 → **HTML** 선택 → 파일 이름 입력

**주의사항**:
- 모든 파일은 루트 레벨에 생성 (폴더 구조 없음)
- 파일 이름은 정확히 일치해야 함 (대소문자 구분)
- HTML 파일에서 `include('Stylesheet')`는 파일 이름만 사용 (확장자 제외)

---

## 코드 배포

### 방법 1: 직접 입력 (권장)

1. 각 파일을 Apps Script 에디터에서 직접 생성
2. 코드 복사 및 붙여넣기
3. 저장 (Ctrl+S 또는 Cmd+S)

### 방법 2: clasp 사용 (고급)

```bash
# clasp 설치
npm install -g @google/clasp

# 로그인
clasp login

# 프로젝트 클론 (스크립트 ID 필요)
clasp clone [SCRIPT_ID]

# 로컬에서 편집 후 푸시
clasp push
```

---

## 초기 설정

### 1단계: Properties 초기화

1. Apps Script 에디터에서 **Code.gs** 선택
2. 함수 선택 드롭다운에서 **initialSetup** 선택
3. **실행** 버튼 클릭
4. 권한 승인 (최초 1회)

### 2단계: 권한 승인

1. **권한 검토** 팝업에서 **권한 확인** 클릭
2. Google 계정 선택
3. **고급** → **부품발주시스템(안전하지 않음)으로 이동** 클릭
4. **허용** 클릭

### 3단계: 초기화 확인

1. 스프레드시트로 돌아가기
2. **로그** 시트에 초기화 로그 확인
3. Drive에서 **부품발주_사진첨부** 폴더 생성 확인

---

## 웹 앱 배포

### 1단계: 배포 설정

1. Apps Script 에디터에서 **배포** → **새 배포** 클릭
2. 설정:
   - **유형 선택**: 웹 앱
   - **설명**: `부품발주시스템 v1.0`
   - **실행 권한**: 나 (배포자)
   - **액세스 권한**: 조직 내 모든 사용자 (또는 모든 사용자)

### 2단계: 배포 실행

1. **배포** 버튼 클릭
2. 웹 앱 URL 복사 (예: `https://script.google.com/macros/s/[DEPLOYMENT_ID]/exec`)
3. **확인** 클릭

### 3단계: URL 공유

1. 복사한 URL을 직원들에게 공유
2. 또는 조직 내부 포털에 링크 등록

---

## 트리거 설정

### 자동 설정 (권장)

1. Apps Script 에디터에서 **Triggers.gs** 선택
2. 함수 선택: **setupAllTriggers**
3. **실행** 버튼 클릭
4. 권한 승인 (필요시)

### 수동 설정

1. **트리거** 탭 클릭 (왼쪽 메뉴)
2. **트리거 추가** 클릭
3. 각 트리거 설정:
   - **실행할 함수**: `performDailyBackup`
   - **이벤트 소스**: 시간 기반
   - **시간 기반 트리거 유형**: 매일 타이머
   - **시간**: 오전 2시 ~ 오전 3시

---

## 테스트

### 1단계: 사용자 등록 확인

1. **사용자관리** 시트에서 테스트 사용자 추가
2. 웹 앱 URL 접속
3. 로그인 확인

### 2단계: 신청 기능 테스트

1. 신청자 계정으로 로그인
2. 신청 폼 작성
3. 사진 첨부
4. 신청 제출
5. **신청내역** 시트에서 데이터 확인

### 3단계: 관리자 기능 테스트

1. 관리자 계정으로 로그인
2. 신청 목록 확인
3. 상태 변경 테스트
4. 담당자 배정 테스트

### 4단계: 알림 테스트

1. 신규 신청 생성
2. 관리자 이메일 확인
3. 상태 변경 시 신청자 이메일 확인

---

## 문제 해결

### 문제 1: 권한 오류

**증상**: "권한이 필요합니다" 오류

**해결**:
1. Apps Script 에디터에서 **실행** → **권한 검토**
2. 권한 다시 승인
3. 웹 앱 재배포

### 문제 2: 시트를 찾을 수 없음

**증상**: "시트를 찾을 수 없습니다" 오류

**해결**:
1. 시트 이름 확인 (정확히 일치해야 함)
2. `initialSetup()` 함수 재실행

### 문제 3: 사진 업로드 실패

**증상**: 사진 업로드 시 오류

**해결**:
1. Drive 폴더 ID 확인
2. `initializeProperties()` 함수 재실행
3. 폴더 공유 설정 확인

### 문제 4: 이메일 발송 실패

**증상**: 알림 이메일이 발송되지 않음

**해결**:
1. Gmail API 활성화 확인
2. 일일 발송 한도 확인 (무료: 100통/일)
3. 스팸 폴더 확인

### 문제 5: 트리거 실행 안 됨

**증상**: 자동 백업이 실행되지 않음

**해결**:
1. 트리거 탭에서 트리거 상태 확인
2. `setupAllTriggers()` 함수 재실행
3. 실행 로그 확인

---

## 추가 설정

### Drive 폴더 구조 최적화

1. Drive에서 **부품발주_사진첨부** 폴더 확인
2. 하위 폴더 구조 생성 (연도/월별)

### 시트 보호 설정

1. **신청내역** 시트 선택
2. **데이터** → **시트 및 범위 보호**
3. 보호 설정 (관리자만 편집)

### 사용자 관리

1. **사용자관리** 시트에서 사용자 추가/수정
2. 역할: `신청자` 또는 `관리자`
3. 활성화: `Y` 또는 `N`

---

## 배포 체크리스트

- [ ] 스프레드시트 생성 및 시트 구조 설정
- [ ] Apps Script 코드 배포
- [ ] 초기 설정 실행 (`initialSetup`)
- [ ] 웹 앱 배포 및 URL 확인
- [ ] 트리거 설정
- [ ] 테스트 사용자 등록
- [ ] 신청 기능 테스트
- [ ] 관리자 기능 테스트
- [ ] 이메일 알림 테스트
- [ ] 사용자 교육 자료 준비

---

## 다음 단계

1. 사용자 매뉴얼 배포
2. 사용자 교육 진행
3. 피드백 수집 및 개선
4. 정기 백업 확인
5. 로그 모니터링

---

## 지원

문제가 발생하면:
1. Apps Script 실행 로그 확인
2. 스프레드시트 로그 시트 확인
3. 관리자에게 문의

